#include "moon-converter.h"

extern "C"{
#include "game/ingame_menu.h"
#include "game/game_init.h"
#include "game/segment2.h"
#include "gfx_dimensions.h"
#include "config.h"
#include "game/geo_misc.h"
}

map<wchar_t, vector<int>> charmap2 = {
    {L'\n', { 254, -1 }}, {L' ', { 158, -1 }}, {L'!', { 242, -1 }}, {L'$', { 249, -1 }}, 
    {L'%', { 243, -1 }},  {L'&', { 229, -1 }}, {L'\'', { 62, -1 }}, {L'(', { 225, -1 }}, 
    {L')', { 226, -1 }},  {L')', { 227, -1 }}, {L'+', { 228, -1 }}, {L',', { 111, -1 }}, 
    {L'-', { 159, -1 }},  {L'.', { 63, -1 }},  {L'/', { 208, -1 }}, {L'0', { 0, -1 }}, 
    {L'1', { 1, -1 }},    {L'2', { 2, -1 }},   {L'3', { 3, -1 }}, {L'4', { 4, -1 }}, 
    {L'5', { 5, -1 }},    {L'6', { 6, -1 }},   {L'7', { 7, -1 }}, {L'8', { 8, -1 }}, 
    {L'9', { 9, -1 }},    {L':', { 230, -1 }}, {L'<', { 82, -1 }}, {L'>', { 83, -1 }}, 
    {L'?', { 244, -1 }},  {L'A', { 10, -1 }},  {L'B', { 11, -1 }}, {L'C', { 12, -1 }}, 
    {L'D', { 13, -1 }},   {L'E', { 14, -1 }},  {L'F', { 15, -1 }}, {L'G', { 16, -1 }}, 
    {L'H', { 17, -1 }},   {L'I', { 18, -1 }},  {L'J', { 19, -1 }}, {L'K', { 20, -1 }}, 
    {L'L', { 21, -1 }},   {L'M', { 22, -1 }},  {L'N', { 23, -1 }}, {L'O', { 24, -1 }}, 
    {L'P', { 25, -1 }},   {L'Q', { 26, -1 }},  {L'R', { 27, -1 }}, {L'S', { 28, -1 }}, 
    {L'T', { 29, -1 }},   {L'U', { 30, -1 }},  {L'V', { 31, -1 }}, {L'W', { 32, -1 }}, 
    {L'X', { 33, -1 }},   {L'Y', { 34, -1 }},  {L'Z', { 35, -1 }}, {L'^', { 80, -1 }}, 
    {L'a', { 36, -1 }},   {L'b', { 37, -1 }},  {L'c', { 38, -1 }}, {L'd', { 39, -1 }}, 
    {L'e', { 40, -1 }},   {L'f', { 41, -1 }},  {L'g', { 42, -1 }}, {L'h', { 43, -1 }}, 
    {L'i', { 44, -1 }},   {L'j', { 45, -1 }},  {L'k', { 46, -1 }}, {L'l', { 47, -1 }}, 
    {L'm', { 48, -1 }},   {L'n', { 49, -1 }},  {L'o', { 50, -1 }}, {L'p', { 51, -1 }}, 
    {L'q', { 52, -1 }},   {L'r', { 53, -1 }},  {L's', { 54, -1 }}, {L't', { 55, -1 }}, 
    {L'u', { 56, -1 }},   {L'v', { 57, -1 }},  {L'w', { 58, -1 }}, {L'x', { 59, -1 }}, 
    {L'y', { 60, -1 }},   {L'z', { 61, -1 }},  {L'|', { 81, -1 }}, {L'~', { 247, -1 }}, 
    {L'¡', { 66, -1 }},   {L'¿', { 67, -1 }},  {L'À', { 68, -1 }}, {L'Á', { 69, -1 }}, 
    {L'Â', { 70, -1 }},   {L'Ã', { 71, -1 }},  {L'Ä', { 72, -1 }}, {L'Å', { 73, -1 }}, 
    {L'Æ', { 74, -1 }},   {L'Ç', { 75, -1 }},  {L'È', { 76, -1 }}, {L'É', { 77, -1 }}, 
    {L'Ê', { 78, -1 }},   {L'Ë', { 79, -1 }},  {L'Ì', { 89, -1 }}, {L'Í', { 90, -1 }}, 
    {L'Î', { 91, -1 }},   {L'Ï', { 92, -1 }},  {L'Ð', { 93, -1 }}, {L'Ñ', { 94, -1 }}, 
    {L'Ò', { 95, -1 }},   {L'Ó', { 96, -1 }},  {L'Ô', { 97, -1 }}, {L'Õ', { 98, -1 }}, 
    {L'Ö', { 99, -1 }},   {L'×', { 251, -1 }}, {L'Ø', { 100, -1 }}, {L'Ù', { 101, -1 }}, 
    {L'Ú', { 102, -1 }},  {L'Û', { 103, -1 }}, {L'Ü', { 104, -1 }}, {L'Ý', { 105, -1 }}, 
    {L'Þ', { 106, -1 }},  {L'ß', { 107, -1 }}, {L'à', { 108, -1 }}, {L'á', { 109, -1 }}, 
    {L'â', { 110, -1 }},  {L'ã', { 112, -1 }}, {L'ä', { 113, -1 }}, {L'å', { 114, -1 }}, 
    {L'æ', { 115, -1 }},  {L'ç', { 116, -1 }}, {L'è', { 117, -1 }}, {L'é', { 118, -1 }}, 
    {L'ê', { 119, -1 }},  {L'ë', { 120, -1 }}, {L'ì', { 121, -1 }}, {L'í', { 122, -1 }}, 
    {L'î', { 123, -1 }},  {L'ï', { 124, -1 }}, {L'ð', { 125, -1 }}, {L'ñ', { 126, -1 }}, 
    {L'ò', { 127, -1 }},  {L'ó', { 128, -1 }}, {L'ô', { 129, -1 }}, {L'õ', { 130, -1 }}, 
    {L'ö', { 131, -1 }},  {L'ø', { 132, -1 }}, {L'ù', { 133, -1 }}, {L'ú', { 134, -1 }}, 
    {L'û', { 135, -1 }},  {L'ü', { 136, -1 }}, {L'ý', { 137, -1 }}, {L'þ', { 138, -1 }}, 
    {L'ÿ', { 139, -1 }},  {L'Ą', { 140, -1 }}, {L'ą', { 141, -1 }}, {L'Ć', { 142, -1 }}, 
    {L'ć', { 143, -1 }}, {L'Ę', { 144, -1 }}, {L'ę', { 145, -1 }}, {L'Ğ', { 146, -1 }}, 
    {L'ğ', { 147, -1 }}, {L'İ', { 148, -1 }}, {L'ı', { 149, -1 }}, {L'Ł', { 150, -1 }}, 
    {L'ł', { 151, -1 }}, {L'Ń', { 152, -1 }}, {L'ń', { 153, -1 }}, {L'Œ', { 154, -1 }}, 
    {L'œ', { 155, -1 }}, {L'Ś', { 156, -1 }}, {L'ś', { 157, -1 }}, {L'Ş', { 160, -1 }}, 
    {L'ş', { 161, -1 }},  {L'Ÿ', { 162, -1 }}, {L'Ź', { 163, -1 }}, {L'ź', { 164, -1 }}, 
    {L'Ż', { 165, -1 }}, {L'ż', { 166, -1 }}, {L'ẞ', { 167, -1 }}, {L'…', { 248, -1 }}, 
    {L'↔', { 228, -1 }},  {L'★', { 250, -1 }}, {L'☆', { 253, -1 }}, {L'☺', { 64, -1 }}, 
    {L'　', { 158, -1 }}, {L'『', { 245, -1 }}, {L'』', { 246, -1 }}, {L'゛', { 240, -1 }}, 
    {L'゜', { 241, -1 }},   {L'・', { 252, -1 }}, {L'！', { 242, -1 }}, {L'％', { 243, -1 }}, 
    {L'＆', { 229, -1 }},   {L'＇', { 62, -1 }}, {L'（', { 225, -1 }}, {L'）', { 226, -1 }}, 
    {L'）', { 227, -1 }},   {L'＋', { 228, -1 }}, {L'，', { 111, -1 }}, {L'－', { 159, -1 }}, 
    {L'．', { 63, -1 }},    {L'０', { 0, -1 }}, {L'１', { 1, -1 }}, {L'２', { 2, -1 }}, 
    {L'３', { 3, -1 }},     {L'４', { 4, -1 }}, {L'５', { 5, -1 }}, {L'６', { 6, -1 }}, 
    {L'７', { 7, -1 }},     {L'８', { 8, -1 }}, {L'９', { 9, -1 }}, {L'：', { 230, -1 }}, 
    {L'？', { 244, -1 }},   {L'Ａ', { 10, -1 }}, {L'Ｂ', { 11, -1 }}, {L'Ｃ', { 12, -1 }}, 
    {L'Ｄ', { 13, -1 }},    {L'Ｅ', { 14, -1 }}, {L'Ｆ', { 15, -1 }}, {L'Ｇ', { 16, -1 }}, 
    {L'Ｈ', { 17, -1 }},    {L'Ｉ', { 18, -1 }}, {L'Ｊ', { 19, -1 }}, {L'Ｋ', { 20, -1 }}, 
    {L'Ｌ', { 21, -1 }},    {L'Ｍ', { 22, -1 }}, {L'Ｎ', { 23, -1 }}, {L'Ｏ', { 24, -1 }}, 
    {L'Ｐ', { 25, -1 }},    {L'Ｑ', { 26, -1 }}, {L'Ｒ', { 27, -1 }}, {L'Ｓ', { 28, -1 }}, 
    {L'Ｔ', { 29, -1 }},    {L'Ｕ', { 30, -1 }}, {L'Ｖ', { 31, -1 }}, {L'Ｗ', { 32, -1 }}, 
    {L'Ｘ', { 33, -1 }},    {L'Ｙ', { 34, -1 }}, {L'Ｚ', { 35, -1 }}, {L'ａ', { 36, -1 }}, 
    {L'ｂ', { 37, -1 }},    {L'ｃ', { 38, -1 }}, {L'ｄ', { 39, -1 }}, {L'ｅ', { 40, -1 }}, 
    {L'ｆ', { 41, -1 }},    {L'ｇ', { 42, -1 }}, {L'ｈ', { 43, -1 }}, {L'ｉ', { 44, -1 }}, 
    {L'ｊ', { 45, -1 }},    {L'ｋ', { 46, -1 }}, {L'ｌ', { 47, -1 }}, {L'ｍ', { 48, -1 }}, 
    {L'ｎ', { 49, -1 }},    {L'ｏ', { 50, -1 }}, {L'ｐ', { 51, -1 }}, {L'ｑ', { 52, -1 }}, 
    {L'ｒ', { 53, -1 }},    {L'ｓ', { 54, -1 }}, {L'ｔ', { 55, -1 }}, {L'ｕ', { 56, -1 }}, 
    {L'ｖ', { 57, -1 }},    {L'ｗ', { 58, -1 }}, {L'ｘ', { 59, -1 }}, {L'ｙ', { 60, -1 }}, 
};

void MoonDrawGenericChar(wchar_t c) {
    gDPPipeSync(gDisplayListHead++);
    string path = "textures/font/character_" + to_string(c) + ".rgba16.png";
    gDPSetTextureImage(gDisplayListHead++, G_IM_FMT_IA, G_IM_SIZ_16b, 1, path.c_str());
    gSPDisplayList(gDisplayListHead++, dl_ia_text_tex_settings);
}

u8* MoonGetTranslatedText(wstring txt){
    vector<u8> translated;

    for (int i = 0; i < txt.size(); i++) {
        wchar_t wc = txt[i];
        
        map<wchar_t, vector<int>>::iterator it = charmap2.find(wc);
        if(it != charmap2.end()) {
            translated.push_back(it->second[0]);
            printf("%s - %d\n", it->first, it->second[0]);
        }
    }

    translated.push_back(0xFF);
    return translated.data();
}